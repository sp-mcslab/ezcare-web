generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CallRecord {
  userId String    @db.VarChar(100)
  roomId String    @db.VarChar(100)
  joinAt DateTime? @db.Timestamp(6)
  exitAt DateTime? @db.Timestamp(6)
  Room   Room      @relation(fields: [roomId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User   User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([userId, roomId])
}

model Host {
  roomId String @db.VarChar(100)
  userId String @db.VarChar(100)
  Room   Room   @relation(fields: [roomId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User   User   @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([roomId, userId])
}

model Invite {
  userId String @db.VarChar(100)
  roomId String @db.VarChar(100)
  Room   Room   @relation(fields: [roomId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User   User   @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([userId, roomId])
}

model Room {
  id         String       @id @db.VarChar(100)
  creatorId  String       @db.VarChar(100)
  name       String?      @db.VarChar(100)
  createdAt  DateTime?    @db.Timestamp(6)
  openAt     DateTime?    @db.Timestamp(6)
  deletedAt  DateTime?    @db.Timestamp(6)
  CallRecord CallRecord[]
  Host       Host[]
  Invite     Invite[]
  User       User         @relation(fields: [creatorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model User {
  id         String       @id @db.VarChar(100)
  username   String?      @db.VarChar(100)
  password   String?      @db.VarChar(100)
  name       String?      @db.VarChar(100)
  phone      String?      @db.VarChar(100)
  pin        String?      @db.VarChar(100)
  department String?      @db.VarChar(100)
  role       UserRole?
  CallRecord CallRecord[]
  Host       Host[]
  Invite     Invite[]
  Room       Room[]
}

enum UserRole {
  nurse
  doctor
  patient
  systemManager
}
